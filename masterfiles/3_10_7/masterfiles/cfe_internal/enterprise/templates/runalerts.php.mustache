#!{{{vars.sys.workdir}}}/httpd/php/bin/php
# Rendered by CFEngine

<?php
if(PHP_SAPI != 'cli')
{
  print("Only allowed to run from the CLI");
}

while(1 == 1)
{
  $sqlstatus=0;
  touch ('{{{vars.cfe_internal_php_runalerts.runalerts_stampfiles_dir}}}/runalerts_sql');
  passthru('{{{vars.sys.workdir}}}/httpd/php/bin/php {{{vars.sys.workdir}}}/httpd/htdocs/index.php cli_tasks runalerts {{{vars.cfe_internal_php_runalerts.sql[limit]}}} {{{vars.cfe_internal_php_runalerts.sql[running]}}} sql', $sqlstatus);

  if ($sqlstatus != 0){
    print("Error executing cli_task runalerts sql");
    print("Sleeping for {{{vars.cfe_internal_php_runalerts.sleep_time}}} seconds");
  }

  $sketchstatus=0;
  touch('{{{vars.cfe_internal_php_runalerts.runalerts_stampfiles_dir}}}/runalerts_sketch');
  passthru('{{{vars.sys.workdir}}}/httpd/php/bin/php {{{vars.sys.workdir}}}/httpd/htdocs/index.php cli_tasks runalerts {{{vars.cfe_internal_php_runalerts.sketch[limit]}}} {{{vars.cfe_internal_php_runalerts.sketch[running]}}} sketch', $sketchstatus);

  if ($sketchstatus != 0){
    print("Error executing cli_task runalerts sketch");
    print("Sleeping for {{{vars.cfe_internal_php_runalerts.sleep_time}}} seconds");
  }

  sleep({{{vars.cfe_internal_php_runalerts.sleep_time}}});
}
?>
